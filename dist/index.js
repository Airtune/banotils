"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("crypto");function t(t){return(4294967296+t).toString(16).substring(1)}var n={normalizeInput:function(t){let n;if(t instanceof Uint8Array)n=t;else if(t instanceof Buffer)n=new Uint8Array(t);else{if("string"!=typeof t)throw new Error("Input must be an string, Buffer or Uint8Array");n=new Uint8Array(Buffer.from(t,"utf8"))}return n},toHex:function(t){return Array.prototype.map.call(t,(function(t){return(t<16?"0":"")+t.toString(16)})).join("")},debugPrint:function(n,e,r){let o="\n"+n+" = ";for(let i=0;i<e.length;i+=2){if(32===r)o+=t(e[i]).toUpperCase(),o+=" ",o+=t(e[i+1]).toUpperCase();else{if(64!==r)throw new Error("Invalid size "+r);o+=t(e[i+1]).toUpperCase(),o+=t(e[i]).toUpperCase()}i%6==4?o+="\n"+new Array(n.length+4).join(" "):i<e.length-2&&(o+=" ")}console.log(o)},testSpeed:function(t,n,e){let r=(new Date).getTime();const o=new Uint8Array(n);for(let t=0;t<n;t++)o[t]=t%256;const i=(new Date).getTime();console.log("Generated random input in "+(i-r)+"ms"),r=i;for(let i=0;i<e;i++){const e=t(o),i=(new Date).getTime(),a=i-r;r=i,console.log("Hashed in "+a+"ms: "+e.substring(0,20)+"..."),console.log(Math.round(n/(1<<20)/(a/1e3)*100)/100+" MB PER SECOND")}}};const e=n;function r(t,n,e){const r=t[n]+t[e];let o=t[n+1]+t[e+1];r>=4294967296&&o++,t[n]=r,t[n+1]=o}function o(t,n,e,r){let o=t[n]+e;e<0&&(o+=4294967296);let i=t[n+1]+r;o>=4294967296&&i++,t[n]=o,t[n+1]=i}function i(t,n){return t[n]^t[n+1]<<8^t[n+2]<<16^t[n+3]<<24}function a(t,n,e,i,a,c){const u=l[a],f=l[a+1],b=l[c],h=l[c+1];r(s,t,n),o(s,t,u,f);let p=s[i]^s[t],g=s[i+1]^s[t+1];s[i]=g,s[i+1]=p,r(s,e,i),p=s[n]^s[e],g=s[n+1]^s[e+1],s[n]=p>>>24^g<<8,s[n+1]=g>>>24^p<<8,r(s,t,n),o(s,t,b,h),p=s[i]^s[t],g=s[i+1]^s[t+1],s[i]=p>>>16^g<<16,s[i+1]=g>>>16^p<<16,r(s,e,i),p=s[n]^s[e],g=s[n+1]^s[e+1],s[n]=g>>>31^p<<1,s[n+1]=p>>>31^g<<1}const c=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),u=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map((function(t){return 2*t}))),s=new Uint32Array(32),l=new Uint32Array(32);function f(t,n){let e=0;for(e=0;e<16;e++)s[e]=t.h[e],s[e+16]=c[e];for(s[24]=s[24]^t.t,s[25]=s[25]^t.t/4294967296,n&&(s[28]=~s[28],s[29]=~s[29]),e=0;e<32;e++)l[e]=i(t.b,4*e);for(e=0;e<12;e++)a(0,8,16,24,u[16*e+0],u[16*e+1]),a(2,10,18,26,u[16*e+2],u[16*e+3]),a(4,12,20,28,u[16*e+4],u[16*e+5]),a(6,14,22,30,u[16*e+6],u[16*e+7]),a(0,10,20,30,u[16*e+8],u[16*e+9]),a(2,12,22,24,u[16*e+10],u[16*e+11]),a(4,14,16,26,u[16*e+12],u[16*e+13]),a(6,8,18,28,u[16*e+14],u[16*e+15]);for(e=0;e<16;e++)t.h[e]=t.h[e]^s[e]^s[e+16]}function b(t,n){if(0===t||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(n&&n.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");const e={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};for(let t=0;t<16;t++)e.h[t]=c[t];const r=n?n.length:0;return e.h[0]^=16842752^r<<8^t,n&&(h(e,n),e.c=128),e}function h(t,n){for(let e=0;e<n.length;e++)128===t.c&&(t.t+=t.c,f(t,!1),t.c=0),t.b[t.c++]=n[e]}function p(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;f(t,!0);const n=new Uint8Array(t.outlen);for(let e=0;e<t.outlen;e++)n[e]=t.h[e>>2]>>8*(3&e);return n}function g(t,n,r){r=r||64,t=e.normalizeInput(t);const o=b(r,n);return h(o,t),p(o)}var d={blake2b:g,blake2bHex:function(t,n,r){const o=g(t,n,r);return e.toHex(o)},blake2bInit:b,blake2bUpdate:h,blake2bFinal:p};const x=n;function y(t,n){return t[n]^t[n+1]<<8^t[n+2]<<16^t[n+3]<<24}function w(t,n,e,r,o,i){I[t]=I[t]+I[n]+o,I[r]=A(I[r]^I[t],16),I[e]=I[e]+I[r],I[n]=A(I[n]^I[e],12),I[t]=I[t]+I[n]+i,I[r]=A(I[r]^I[t],8),I[e]=I[e]+I[r],I[n]=A(I[n]^I[e],7)}function A(t,n){return t>>>n^t<<32-n}const v=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),k=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),I=new Uint32Array(16),m=new Uint32Array(16);function U(t,n){let e=0;for(e=0;e<8;e++)I[e]=t.h[e],I[e+8]=v[e];for(I[12]^=t.t,I[13]^=t.t/4294967296,n&&(I[14]=~I[14]),e=0;e<16;e++)m[e]=y(t.b,4*e);for(e=0;e<10;e++)w(0,4,8,12,m[k[16*e+0]],m[k[16*e+1]]),w(1,5,9,13,m[k[16*e+2]],m[k[16*e+3]]),w(2,6,10,14,m[k[16*e+4]],m[k[16*e+5]]),w(3,7,11,15,m[k[16*e+6]],m[k[16*e+7]]),w(0,5,10,15,m[k[16*e+8]],m[k[16*e+9]]),w(1,6,11,12,m[k[16*e+10]],m[k[16*e+11]]),w(2,7,8,13,m[k[16*e+12]],m[k[16*e+13]]),w(3,4,9,14,m[k[16*e+14]],m[k[16*e+15]]);for(e=0;e<8;e++)t.h[e]^=I[e]^I[e+8]}function B(t,n){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const e=n?n.length:0;if(n&&!(e>0&&e<=32))throw new Error("Incorrect key length, should be in [1, 32]");const r={h:new Uint32Array(v),b:new Uint8Array(64),c:0,t:0,outlen:t};return r.h[0]^=16842752^e<<8^t,e>0&&(F(r,n),r.c=64),r}function F(t,n){for(let e=0;e<n.length;e++)64===t.c&&(t.t+=t.c,U(t,!1),t.c=0),t.b[t.c++]=n[e]}function _(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;U(t,!0);const n=new Uint8Array(t.outlen);for(let e=0;e<t.outlen;e++)n[e]=t.h[e>>2]>>8*(3&e)&255;return n}function E(t,n,e){e=e||32,t=x.normalizeInput(t);const r=B(e,n);return F(r,t),_(r)}var S={blake2s:E,blake2sHex:function(t,n,e){const r=E(t,n,e);return x.toHex(r)},blake2sInit:B,blake2sUpdate:F,blake2sFinal:_};var C={blake2b:d.blake2b,blake2bHex:d.blake2bHex,blake2bInit:d.blake2bInit,blake2bUpdate:d.blake2bUpdate,blake2bFinal:d.blake2bFinal,blake2s:S.blake2s,blake2sHex:S.blake2sHex,blake2sInit:S.blake2sInit,blake2sUpdate:S.blake2sUpdate,blake2sFinal:S.blake2sFinal};const G=function(t){let n;const e=new Float64Array(16);if(t)for(n=0;n<t.length;n++)e[n]=t[n];return e};new Uint8Array(32)[0]=9;const H=G(),D=G([1]);G([56129,1]),G([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]);const M=G([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),R=G([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),P=G([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]);function L(t,n){let e;for(e=0;e<16;e++)t[e]=0|n[e]}function W(t){let n,e;for(e=0;e<16;e++)t[e]+=65536,n=Math.floor(t[e]/65536),t[(e+1)*(e<15?1:0)]+=n-1+37*(n-1)*(15===e?1:0),t[e]-=65536*n}function j(t,n,e){let r;const o=~(e-1);for(let e=0;e<16;e++)r=o&(t[e]^n[e]),t[e]^=r,n[e]^=r}function T(t,n){let e,r,o;const i=G(),a=G();for(e=0;e<16;e++)a[e]=n[e];for(W(a),W(a),W(a),r=0;r<2;r++){for(i[0]=a[0]-65517,e=1;e<15;e++)i[e]=a[e]-65535-(i[e-1]>>16&1),i[e-1]&=65535;i[15]=a[15]-32767-(i[14]>>16&1),o=i[15]>>16&1,i[14]&=65535,j(a,i,1-o)}for(e=0;e<16;e++)t[2*e]=255&a[e],t[2*e+1]=a[e]>>8}function O(t,n,e){let r;for(r=0;r<16;r++)t[r]=n[r]+e[r]|0}function V(t,n,e){let r;for(r=0;r<16;r++)t[r]=n[r]-e[r]|0}function $(t,n,e){let r,o;const i=new Float64Array(31);for(r=0;r<31;r++)i[r]=0;for(r=0;r<16;r++)for(o=0;o<16;o++)i[r+o]+=n[r]*e[o];for(r=0;r<15;r++)i[r]+=38*i[r+16];for(r=0;r<16;r++)t[r]=i[r];W(t),W(t)}function N(t,n){$(t,n,n)}function z(t,n){const e=G(),r=G(),o=G(),i=G(),a=G(),c=G(),u=G(),s=G(),l=G();V(e,t[1],t[0]),V(l,n[1],n[0]),$(e,e,l),O(r,t[0],t[1]),O(l,n[0],n[1]),$(r,r,l),$(o,t[3],n[3]),$(o,o,M),$(i,t[2],n[2]),O(i,i,i),V(a,r,e),V(c,i,o),O(u,i,o),O(s,r,e),$(t[0],a,c),$(t[1],s,u),$(t[2],u,c),$(t[3],a,s)}function q(t,n,e){let r;for(r=0;r<4;r++)j(t[r],n[r],e)}function K(t,n){const e=G(),r=G(),o=G();!function(t,n){const e=G();let r;for(r=0;r<16;r++)e[r]=n[r];for(r=253;r>=0;r--)N(e,e),2!==r&&4!==r&&$(e,e,n);for(r=0;r<16;r++)t[r]=e[r]}(o,n[2]),$(e,n[0],o),$(r,n[1],o),T(t,r),t[31]^=function(t){const n=new Uint8Array(32);return T(n,t),1&n[0]}(e)<<7}function Y(t,n){const e=[G(),G(),G(),G()];L(e[0],R),L(e[1],P),L(e[2],D),$(e[3],R,P),function(t,n,e){let r,o;for(L(t[0],H),L(t[1],D),L(t[2],D),L(t[3],H),o=255;o>=0;--o)r=e[o/8|0]>>(7&o)&1,q(t,n,r),z(n,t),z(t,t),q(t,n,r)}(t,e,n)}G([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);const J=t=>{const n=t.length/4*5,e=new Uint8Array(n);for(let r=1;r<=n;r++){const n=r-1,o=r%5,i=n-(r-o)/5,a=t[i-1]<<5-o,c=t[i]>>o;e[n]=(c+a)%16}return e},X=t=>{const n=new Uint8Array(2*t.length);for(let e=0;e<t.length;e++)n[2*e]=t[e]/16|0,n[2*e+1]=t[e]%16;return n},Q=t=>{const n=t.length/2,e=new Uint8Array(n);for(let r=0;r<n;r++)e[r]=16*t[2*r]+t[2*r+1];return e},Z=t=>{const n="13456789abcdefghijkmnopqrstuwxyz".split(""),e=t.length,r=t.split(""),o=new Uint8Array(e);for(let t=0;t<e;t++)o[t]=n.indexOf(r[t]);return o},tt=t=>{const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=parseInt(t.substr(e,1),16);return n},nt=t=>{const n=t.length/5*4,e=new Uint8Array(n);for(let r=1;r<=n;r++){const o=r-1,i=r%4,a=o+(r-i)/4,c=t[a]<<i;let u;u=(n-r)%4==0?t[a-1]<<4:t[a+1]>>4-i,e[o]=(u+c)%32}return e},et=t=>{const n="13456789abcdefghijkmnopqrstuwxyz".split("");let e="";for(let r=0;r<t.length;r++)e+=n[t[r]];return e},rt=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ot(t,n){let e,r,o,i;for(r=63;r>=32;--r){for(e=0,o=r-32,i=r-12;o<i;++o)n[o]+=e-16*n[r]*rt[o-(r-32)],e=n[o]+128>>8,n[o]-=256*e;n[o]+=e,n[r]=0}for(e=0,o=0;o<32;o++)n[o]+=e-(n[31]>>4)*rt[o],e=n[o]>>8,n[o]&=255;for(o=0;o<32;o++)n[o]-=e*rt[o];for(r=0;r<32;r++)n[r+1]+=n[r]>>8,t[r]=255&n[r]}function it(t){const n=new Float64Array(64);let e;for(e=0;e<64;e++)n[e]=t[e];for(e=0;e<64;e++)t[e]=0;ot(t,n)}function at(t){let n=new Uint8Array(64);const e=[G(),G(),G(),G()],r=new Uint8Array(32),o=C.blake2bInit(64);return C.blake2bUpdate(o,t),n=C.blake2bFinal(o),n[0]&=248,n[31]&=127,n[31]|=64,Y(e,n),K(r,e),r}function ct(t){let n=t.substring(4,64);const e=(t=>{const n=t.length-1,e=new Uint8Array(n);for(let r=0;r<n;r++)e[r]=t[r+1];return e})(J(Z(n.substring(0,52)))),r=J(Z(n.substring(52,60))),o=Q(e),i=C.blake2b(o,null,5).reverse(),a=r,c=X(i);if(!((t,n)=>{for(let e=0;e<t.length;e++)if(t[e]!=n[e])return!1;return!0})(a,c)){const t=et(nt(a)),n=et(nt(c));throw new Error(`Incorrect checksum ${t} != ${n}`)}return function(t){const n=new Uint8Array(t.length/2);for(let e=0;e<n.length;++e)n[e]=parseInt(t.substring(2*e+0,2*e+2),16);return n}((t=>{let n="";for(let e=0;e<t.length;e++)n+=t[e].toString(16).toUpperCase();return n})(e))}function ut(t,n){const e=new Uint8Array(64+n.length);!function(t,n,e,r){let o,i,a=new Uint8Array(64),c=new Uint8Array(64),u=new Uint8Array(64);const s=new Float64Array(64),l=[G(),G(),G(),G()],f=at(r);let b=C.blake2bInit(64,null);C.blake2bUpdate(b,r),a=C.blake2bFinal(b),a[0]&=248,a[31]&=127,a[31]|=64;const h=e+64;for(o=0;o<e;o++)t[64+o]=n[o];for(o=0;o<32;o++)t[32+o]=a[32+o];for(b=C.blake2bInit(64,null),C.blake2bUpdate(b,t.subarray(32)),u=C.blake2bFinal(b),it(u),Y(l,u),K(t,l),o=32;o<64;o++)t[o]=f[o-32];for(b=C.blake2bInit(64,null),C.blake2bUpdate(b,t),c=C.blake2bFinal(b),it(c),o=0;o<64;o++)s[o]=0;for(o=0;o<32;o++)s[o]=u[o];for(o=0;o<32;o++)for(i=0;i<32;i++)s[o+i]+=c[o]*a[i];ot(t.subarray(32),s)}(e,n,n.length,t);const r=new Uint8Array(64);for(let t=0;t<r.length;t++)r[t]=e[t];return r}const st=new RegExp("^[0123456789abcdefABCDEF]{64}$");function lt(t){const n=new Uint8Array(t.length/2);for(let e=0;e<n.length;++e)n[e]=parseInt(t.substring(2*e+0,2*e+2),16);return n}function ft(t){return Array.prototype.map.call(t,(t=>("00"+t.toString(16)).slice(-2))).join("").toUpperCase()}function bt(t,n){const e=t.toString().split(""),r=[];let o="";const i=[];for(;e.length;){let t=1*Number(e.shift());for(let n=0;t||n<r.length;++n)t+=10*(r[n]||0),r[n]=t%16,t=(t-r[n])/16}for(;r.length;)i.push(r.pop().toString(16));if(o=i.join(""),o.length%2!=0&&(o="0"+o),n>o.length/2){const t=n-o.length/2;for(let n=0;n<t;n++)o="00"+o}return o}function ht(t){return st.test(ft(t))}function pt(t,n,e){const r=C.blake2bInit(8);C.blake2bUpdate(r,n),C.blake2bUpdate(r,t);const o=ft(C.blake2bFinal(r).reverse());return BigInt("0x"+o)>e}function gt(t){return"string"==typeof t?ct(t):at(t)}function dt(t){return function(t){const n=Q(tt(t)),e=et(nt(X(C.blake2b(n,null,5).reverse())));return`ban_${et(nt(tt(`0${t}`)))}${e}`}(ft(t))}var xt;!function(t){t[t.SEND=0]="SEND",t[t.RECEIVE=1]="RECEIVE"}(xt||(xt={}));function yt(t,n){let e="";for(let r=n-1;r>-1;r--)e+=(t[r]>15?"":"0")+t[r].toString(16);return e}const wt=document.createElement("canvas"),At=wt.getContext("webgl2"),vt=At.createShader(At.VERTEX_SHADER);At.shaderSource(vt,"#version 300 es\nprecision highp float;\n#define GLSLIFY 1\nconst vec2 vertices[4]=vec2[](vec2(-1,+1),vec2(-1,-1),vec2(+1,+1),vec2(+1,-1));void main(){gl_Position=vec4(vertices[gl_VertexID],0.0,1.0);}"),At.compileShader(vt);const kt=At.createShader(At.FRAGMENT_SHADER);At.shaderSource(kt,"#version 300 es\nprecision highp float;precision highp int;\n#define GLSLIFY 1\nout vec4 fragColor;uniform uvec4 uWork0;uniform uvec4 uWork1;uniform uvec4 uHash0;uniform uvec4 uHash1;\n#define BLAKE2B_IV32_1 0x6A09E667u\nuint v[32]=uint[32](0xF2BDC900u,0x6A09E667u,0x84CAA73Bu,0xBB67AE85u,0xFE94F82Bu,0x3C6EF372u,0x5F1D36F1u,0xA54FF53Au,0xADE682D1u,0x510E527Fu,0x2B3E6C1Fu,0x9B05688Cu,0xFB41BD6Bu,0x1F83D9ABu,0x137E2179u,0x5BE0CD19u,0xF3BCC908u,0x6A09E667u,0x84CAA73Bu,0xBB67AE85u,0xFE94F82Bu,0x3C6EF372u,0x5F1D36F1u,0xA54FF53Au,0xADE682F9u,0x510E527Fu,0x2B3E6C1Fu,0x9B05688Cu,0x04BE4294u,0xE07C2654u,0x137E2179u,0x5BE0CD19u);uint m[32];const int SIGMA82[192]=int[192](0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,28,20,8,16,18,30,26,12,2,24,0,4,22,14,10,6,22,16,24,0,10,4,30,26,20,28,6,12,14,2,18,8,14,18,6,2,26,24,22,28,4,12,10,20,8,0,30,16,18,0,10,14,4,8,20,30,28,2,22,24,12,16,6,26,4,24,12,20,0,22,16,6,8,26,14,10,30,28,2,18,24,10,2,30,28,26,8,20,0,14,12,6,18,4,16,22,26,22,14,28,24,2,6,18,10,0,30,8,16,12,4,20,12,30,28,18,22,6,0,16,24,4,26,14,2,8,20,10,20,4,16,8,14,12,2,10,30,22,18,28,6,24,26,0,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,28,20,8,16,18,30,26,12,2,24,0,4,22,14,10,6);void add_uint64(int a,uint b0,uint b1){uint o0=v[a]+b0;uint o1=v[a+1]+b1;if(v[a]>0xFFFFFFFFu-b0){o1++;}v[a]=o0;v[a+1]=o1;}void add_uint64(int a,int b){add_uint64(a,v[b],v[b+1]);}void B2B_G(int a,int b,int c,int d,int ix,int iy){add_uint64(a,b);add_uint64(a,m[ix],m[ix+1]);uint xor0=v[d]^ v[a];uint xor1=v[d+1]^ v[a+1];v[d]=xor1;v[d+1]=xor0;add_uint64(c,d);xor0=v[b]^ v[c];xor1=v[b+1]^ v[c+1];v[b]=(xor0>>24)^(xor1<<8);v[b+1]=(xor1>>24)^(xor0<<8);add_uint64(a,b);add_uint64(a,m[iy],m[iy+1]);xor0=v[d]^ v[a];xor1=v[d+1]^ v[a+1];v[d]=(xor0>>16)^(xor1<<16);v[d+1]=(xor1>>16)^(xor0<<16);add_uint64(c,d);xor0=v[b]^ v[c];xor1=v[b+1]^ v[c+1];v[b]=(xor1>>31)^(xor0<<1);v[b+1]=(xor0>>31)^(xor1<<1);}void main(){int i;uint uv_x=uint(gl_FragCoord.x);uint uv_y=uint(gl_FragCoord.y);uint x_pos=uv_x % 256u;uint y_pos=uv_y % 256u;uint x_index=(uv_x-x_pos)/256u;uint y_index=(uv_y-y_pos)/256u;m[0]=(x_pos ^(y_pos<<8)^((uWork0.b ^ x_index)<<16)^((uWork0.a ^ y_index)<<24));m[1]=(uWork1.r ^(uWork1.g<<8)^(uWork1.b<<16)^(uWork1.a<<24));m[2]=uHash0[0];m[3]=uHash0[1];m[4]=uHash0[2];m[5]=uHash0[3];m[6]=uHash1[0];m[7]=uHash1[1];m[8]=uHash1[2];m[9]=uHash1[3];for(i=0;i<12;i++){B2B_G(0,8,16,24,SIGMA82[i*16+0],SIGMA82[i*16+1]);B2B_G(2,10,18,26,SIGMA82[i*16+2],SIGMA82[i*16+3]);B2B_G(4,12,20,28,SIGMA82[i*16+4],SIGMA82[i*16+5]);B2B_G(6,14,22,30,SIGMA82[i*16+6],SIGMA82[i*16+7]);B2B_G(0,10,20,30,SIGMA82[i*16+8],SIGMA82[i*16+9]);B2B_G(2,12,22,24,SIGMA82[i*16+10],SIGMA82[i*16+11]);B2B_G(4,14,16,26,SIGMA82[i*16+12],SIGMA82[i*16+13]);B2B_G(6,8,18,28,SIGMA82[i*16+14],SIGMA82[i*16+15]);}if((BLAKE2B_IV32_1 ^ v[1]^ v[17])>0xFFFFFE00u){fragColor=vec4(float(x_index+1u)/255.,float(y_index+1u)/255.,float(x_pos)/255.,float(y_pos)/255.);}}"),At.compileShader(kt);const It=At.createProgram();function mt(t){try{return{hash:lt(t.hash)}}catch(t){}return null}At.attachShader(It,vt),At.attachShader(It,kt),At.linkProgram(It);let Ut="";async function Bt(t){const n=await function(t,n=1){wt.width=wt.height=256<<n;const e=function(t){let n="";for(let e=t.length;e>0;e-=2)n+=t.slice(e-2,e);return n}(ft(t));return At.useProgram(It),At.viewport(0,0,At.drawingBufferWidth,At.drawingBufferHeight),At.clearColor(0,0,0,1),At.uniform4uiv(At.getUniformLocation(It,"uHash0"),new Uint32Array([parseInt(e.slice(56,64),16),parseInt(e.slice(48,56),16),parseInt(e.slice(40,48),16),parseInt(e.slice(32,40),16)])),At.uniform4uiv(At.getUniformLocation(It,"uHash1"),new Uint32Array([parseInt(e.slice(24,32),16),parseInt(e.slice(16,24),16),parseInt(e.slice(8,16),16),parseInt(e.slice(0,8),16)])),new Promise((t=>{const n=new Uint8Array(4),e=new Uint8Array(4);requestAnimationFrame((function r(){crypto.getRandomValues(n),crypto.getRandomValues(e),At.uniform4uiv(At.getUniformLocation(It,"uWork0"),Array.from(n)),At.uniform4uiv(At.getUniformLocation(It,"uWork1"),Array.from(e)),At.clear(At.COLOR_BUFFER_BIT),At.drawArrays(At.TRIANGLE_STRIP,0,4);const o=new Uint8Array(At.drawingBufferWidth*At.drawingBufferHeight*4);At.readPixels(0,0,At.drawingBufferWidth,At.drawingBufferHeight,At.RGBA,At.UNSIGNED_BYTE,o);for(let r=0;r<o.length;r+=4)if(0!==o[r]){const i=yt(e,4),a=yt(new Uint8Array([o[r+2],o[r+3],n[2]^o[r]-1,n[3]^o[r+1]-1]),4);return void t(lt(i+a))}requestAnimationFrame(r)}))}))}(t);if(!pt(t,n,0xfffffe00n))throw new Error(`Generated work '${ft(n)}' is invalid`);return n}async function Ft(t,n,e,r,o){const i=gt(t),a=await Bt(n||i),c={type:"state"};return c.account=dt(i),c.previous=ft(n||new Uint8Array(32)),c.representative=dt(e),c.balance=o.toString(10),c.work=ft(a),c.link=ft(r),c.signature=ft(ut(t,function(t){let n=BigInt(t.balance).toString(16);for(;n.length<32;)n="0"+n;const e=C.blake2bInit(32,null);return C.blake2bUpdate(e,lt("0000000000000000000000000000000000000000000000000000000000000006")),C.blake2bUpdate(e,gt(t.account)),C.blake2bUpdate(e,lt(t.previous)),C.blake2bUpdate(e,gt(t.representative)),C.blake2bUpdate(e,lt(n)),C.blake2bUpdate(e,lt(t.link)),C.blake2bFinal(e)}(c))),c}function _t(t){if(!Ut)throw new Error("API URL is invalid");return new Promise(((n,e)=>{const r=JSON.stringify(t);fetch(Ut,{method:"POST",headers:{"Content-Type":"application/json","Content-Length":String(r.length)},body:r}).then((t=>{const e=t.json();n(e)})).catch((t=>{e(t)}))}))}function Et(t){return!!t&&!t.hasOwnProperty("error")}function St(t){const n=new Error("").stack.split("\n")[2].replace(/^\s+at\s+(.+?)\s.+/g,"$1"),e=n.substr(n.lastIndexOf(".")+1).trim();console.warn(`API call '${e}' failed with: '${t}'`)}async function Ct(t){const n=dt(t),e=await _t({action:"account_info",account:n});return Et(e)?function(t){try{return{blockCount:parseInt(t.block_count),frontier:lt(t.frontier),representativeBlock:lt(t.representative_block),modificationTimestamp:parseInt(t.modified_timestamp)}}catch(t){}return null}(e):(St(e.error),null)}async function Gt(t){const n=dt(t),e=await _t({action:"accounts_balances",accounts:[n]});return Et(e)?function(t){try{const n=Object.values(t.balances)[0];return{balance:BigInt(n.balance),pending:BigInt(n.pending)}}catch(t){}return null}(e):(St(e.error),null)}async function Ht(t){const n=dt(t),e=await _t({action:"account_representative",account:n});return Et(e)?function(t){try{return{account:ct(t.representative)}}catch(t){}return null}(e):(St(e.error),null)}async function Dt(t,n=-1){const e=dt(t),r=await _t({action:"account_history",account:e,count:n,raw:!1});return Et(r)?function(t){try{if(Array.isArray(t.history)){const n={history:[]};for(const e of t.history)n.history.push({hash:lt(e.hash),amount:BigInt(e.amount),account:ct(e.account),action:"send"===e.type?xt.SEND:xt.RECEIVE});return n}}catch(t){}return null}(r):(St(r.error),null)}async function Mt(t,n,e,r){const o=await Ft(t,null,n,e,r),i=await _t({action:"process",json_block:"true",subtype:"open",block:o});return Et(i)?mt(i):(St(i.error),null)}exports.bytesToHex=ft,exports.decimalToHex=bt,exports.getAccountAddress=dt,exports.getAccountBalance=Gt,exports.getAccountHistory=Dt,exports.getAccountInfo=Ct,exports.getAccountPending=async function(t,n=-1){const e=dt(t),r=await _t({action:"accounts_pending",accounts:[e],count:n,threshold:1,source:!0});return Et(r)?function(t){try{const n={blocks:[]},e=Object.values(t.blocks)[0];for(const[t,r]of Object.entries(e)){const{amount:e,source:o}=r,i={amount:BigInt(e),hash:lt(t),source:ct(o)};n.blocks.push(i)}return n}catch(t){}return null}(r):(St(r.error),null)},exports.getAccountRepresentative=Ht,exports.getAmountFromRaw=function(t){const n=BigInt("1000000000000000000000000000"),e=BigInt("100000000000000000000000000000"),r=t/e,o=(t-r*e)/n;return r.toString()+"."+o.toString().padStart(2,"0")},exports.getPrivateKey=function(t,n=0){if(!ht(t))throw new Error(`Invalid seed '${t}'`);const e=lt(bt(n,4)),r=C.blake2bInit(32);return C.blake2bUpdate(r,t),C.blake2bUpdate(r,e),C.blake2bFinal(r)},exports.getPublicKey=gt,exports.getRawFromAmount=function(t){const n=t.indexOf(".");let e=BigInt("1");if(-1!==n){const r=(t=t.replace(".","")).length-n;e=BigInt("10")**BigInt(r)}return BigInt(t)*BigInt("100000000000000000000000000000")/e},exports.hexToBytes=lt,exports.isSeedValid=ht,exports.isWorkValid=pt,exports.openAccount=Mt,exports.receiveAccount=async function(t,n,e,r){const o=gt(t),i=await Dt(o),a=await Gt(o);if(!i||0==i.history.length)return Mt(t,n,e,r);const c=r+a.balance,u=(await Ct(o)).frontier,s=await Ft(t,u,n,e,c),l=await _t({action:"process",json_block:"true",subtype:"receive",block:s});return Et(l)?mt(l):(St(l.error),null)},exports.sendAccount=async function(t,n,e){const r=gt(t),o=await Ct(r),i=await Gt(r),a=await Ht(r),c=i.balance-e;if(i.balance<=0n||c<0n)return null;const u=o.frontier,s=await Ft(t,u,a.account,n,c),l=await _t({action:"process",json_block:"true",subtype:"send",block:s});return Et(l)?mt(l):(St(l.error),null)},exports.setAPIURL=function(t){if(!t.startsWith("https")&&!t.startsWith("http"))throw new Error("Invalid API URL");Ut=t};
